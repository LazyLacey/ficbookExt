"use strict";(self.webpackChunkficbook=self.webpackChunkficbook||[]).push([[7],{6849:(e,t,n)=>{n.d(t,{Y:()=>r});let r=String.fromCharCode(160)},399:(e,t,n)=>{n.d(t,{A:()=>u,Y:()=>s});var r=n(6849);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let i=e=>e.replace(/\t{6}/g,"<tab>").replace(/(.)\t(.)/g,"$1"+r.Y+"$2").replace(/\t+/g,"");class s{trimTags(){return this._modifiedCopy=this._modifiedCopy.replace(/^(<(tab|b|i|s|center|right)>)+/gi,"").replace(/(<\/(tab|b|i|s|center|right)>)+$/gi,""),this}removeHardBreaks(){return this._modifiedCopy=this._modifiedCopy.replace(/<br>/g,""),this}removeGrammarSpan(){return this._modifiedCopy=this._modifiedCopy.replace(s.GRAMMAR_SPAN_REGEX,"$<err>"),this}replaceAlignmentParagraphsWithAlignmentTags(){return this._modifiedCopy=this._modifiedCopy.replace(/<p style="\s*margin:\s*0;\s*text-align:\s*(?<align>center|right);?\s*">(?<err>[\s\S]+?)<\/p>/gim,"<$<align>>$<err></$<align>>"),this}replaceTabulationToTabInContext(){return this._modifiedCopy=this._modifiedCopy.replaceAll(RegExp(s.GRAMMAR_SPAN_REGEX,"gi"),(e,t,n)=>'<span class="grammar_error">'+i(n)+"</span>").trim().replace(/\t{6}/g,"<tab>").replace(/\t/g,r.Y),this}unwrapBookmark(){return this._modifiedCopy=this._modifiedCopy.replace(/<mark class="text-bookmark">(?<bookmarkText>[\s\S]+?)<\/mark>/g,"$<bookmarkText>"),this}toString(){return this._modifiedCopy}constructor(e){a(this,"_modifiedCopy",void 0),this._modifiedCopy=e}}a(s,"GRAMMAR_SPAN_REGEX",/<(span|b|i|s|center|right) class="grammar_error">(?<err>[\s\S]*?)<\/\1>/i);var o=n(3492);class u{get textContent(){return this._textArea.textContent}select(e,t){let n=this._textArea;n.focus();let r=n.value;n.value=r.substring(0,t),(0,o.O)(n),n.value=r,setTimeout(()=>n.setSelectionRange(e,t),0)}scrollIntoView(){this._textArea.scrollIntoView({block:"center"})}constructor(e){!function(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}(this,"_textArea",void 0),this._textArea=e}}},3492:(e,t,n)=>{n.d(t,{O:()=>r});let r=e=>{e.scrollTop=0,e.scrollTop=e.scrollHeight}},6820:(e,t,n)=>{n.d(t,{Z:()=>S});var r=n(1536);let a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"left";if(!e)return null;if(e instanceof Text)return e;let n="left"===t?e.lastChild:e.firstChild;return n?a(n,t):null},i=e=>e?e.previousSibling||i(e.parentNode):null,s=e=>e?e.nextSibling||s(e.parentNode):null,o=e=>{if(e instanceof Text)return"";let{outerHTML:t}=e;return t.substring(0,t.indexOf(">")+1)+o(e.firstChild)},u=e=>{if(e instanceof Text)return"";let{outerHTML:t}=e;return u(e.lastChild)+t.substring(t.lastIndexOf("<"),t.length)};var l=n(7554);function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let f=e=>e instanceof HTMLElement&&e.classList.contains("ads-in-text");class c{get expandedCharacterCount(){return{left:this._expandedCharacterCount.left+this._expandedCharacterCount.leftTagCharacters.length,right:this._expandedCharacterCount.right+this._expandedCharacterCount.rightTagCharacters.length}}expandLeft(e){let t=a(this._range.startContainer,"left");if(!t)return;let n=this._range.startOffset,r=this._range.startOffset-e,i=Math.max(r,0);this._range.setStart(t,i),this._expandedCharacterCount.left+=n-i,!(r>=0)&&this.breakoutLeft()&&this.expandLeft(Math.abs(r))}breakoutLeft(){let e=i(this._range.startContainer);if(!e||!this._container.contains(e))return!1;if(f(e))return this._range.setStartBefore(e),this.breakoutLeft();let t=a(e,"left");return this._range.setStart(t,t.length),this._expandedCharacterCount.leftTagCharacters+=u(e),this._expandedCharacterCount.leftTagCharacters+=o(e.nextSibling),!0}expandRight(e){let t=a(this._range.endContainer,"right");if(!t)return;let n=this._range.endOffset+e,r=Math.min(n,t.length);this._expandedCharacterCount.right+=r-this._range.endOffset,this._range.setEnd(t,r),!(n<=t.length)&&this.breakoutRight()&&this.expandRight(n-t.length)}breakoutRight(){let e=s(this._range.endContainer);if(!e||!this._container.contains(e))return!1;if(f(e))return this._range.setEndAfter(e),this.breakoutRight();let t=a(e,"right");return this._range.setEnd(t,0),this._expandedCharacterCount.rightTagCharacters+=o(e),this._expandedCharacterCount.rightTagCharacters+=u(e.previousSibling),!0}toHtmlElement(){let e=document.createElement("div");return e.appendChild(this._range.cloneContents()),e}toSelectionWithContext(){let e=this.toHtmlElement();(0,l.N)(e);let t=e.innerHTML;t=t.replace(/&nbsp;/g,"	");let{left:n,right:r}=this.expandedCharacterCount;if(e.firstChild===e.firstElementChild){let t=o(e.firstElementChild);n+=t.length}if(e.lastChild===e.lastElementChild){let t=u(e.lastElementChild);r+=t.length}let a=t.substring(n,t.length-r),i=t.substring(0,n),s=t.substring(t.length-r),d=i+`<span class="grammar_error">${a}</span>`+s,f=Object.freeze({selection:a,context:d});return f}clone(){return new c(this._range.cloneRange(),this._container)}constructor(e,t){d(this,"_range",void 0),d(this,"_container",void 0),d(this,"_expandedCharacterCount",{left:0,right:0,leftTagCharacters:"",rightTagCharacters:""}),this._range=e.cloneRange(),this._container=t}}function h(e,t,n){if(!t.has(e))throw TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var g=new WeakMap;class m{contains(e){var t;return((t=h(this,g,"get")).get?t.get.call(this):t.value).some(t=>t.contains(e))}constructor(e){!function(e,t,n){(function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}(this,g,{writable:!0,value:void 0}),function(e,t,n){var r=h(e,t,"set");!function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=n}}(e,r,n)}(this,g,e.filter(Boolean))}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class S{getSelectionInContainer(){if(!window.getSelection||!this._container)return null;let e=window.getSelection();if(!e||e.isCollapsed)return null;let t=e.getRangeAt(0);return this._container.contains(t.startContainer)&&this._container.contains(t.endContainer)?e:null}getWrappedSelectionRange(){let e=this.value.value;return e?new c(e.getRangeAt(0).cloneRange(),this._container):null}getSelectionWithContext(e){let t=this.getWrappedSelectionRange();return t?(t.expandLeft(e),t.expandRight(e),t.toSelectionWithContext()):null}clearSelection(){window.getSelection()?.removeAllRanges()}destroy(){document.removeEventListener("selectionchange",this._valueUpdater)}constructor(e){p(this,"value",(0,r.iH)(null)),p(this,"_valueUpdater",void 0),p(this,"_container",void 0),this._container=new m(Array.isArray(e)?e:[e]),this._valueUpdater=()=>{this.value.value=this.getSelectionInContainer()},document.addEventListener("selectionchange",this._valueUpdater)}}},2007:(e,t,n)=>{let r;n.r(t),n.d(t,{BookmarkList:()=>tp,BookmarkMenu:()=>tw,GoToBookmarkButton:()=>tL});var a,i,s,o=n(1101),u=n(4569),l=n(1275);let d={key:0},f={class:"help-box"},c={class:"fake-button"},h={class:"fake-button-text"},g={class:"fake-button"},m=(a=()=>(0,o._)("br",null,null,-1),(0,o.dD)("data-v-3f5a27ac"),a=a(),(0,o.Cn)(),a),p={class:"fake-button fake-button--remove"},S={class:"fake-button-text"},k={class:"text-center font-bold"},D={class:"internal-list"},E={key:0,class:"internal-list"},C=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","BR","DETAILS","DIALOG","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","OL","P","PRE","SECTION","TABLE","UL","TR","TH","TD","COLGROUP","COL","CAPTION","THEAD","TBODY","TFOOT"],F=/[\t-\r -#%-*,-/:;?@[-\]_{}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,b=e=>{let t=[],n=document.createRange();for(n.selectNodeContents(document.body);!n.collapsed&&t.length<2;){let r;if(e.prefix){let t=y(e.prefix,n);if(null==t)break;O(n,t.startContainer,t.startOffset);let a=document.createRange();if(a.setStart(t.endContainer,t.endOffset),a.setEnd(n.endContainer,n.endOffset),T(a),a.collapsed||null==(r=y(e.textStart,a)))break;if(0!==r.compareBoundaryPoints(Range.START_TO_START,a))continue}else{if(null==(r=y(e.textStart,n)))break;O(n,r.startContainer,r.startOffset)}if(e.textEnd){let a=document.createRange();a.setStart(r.endContainer,r.endOffset),a.setEnd(n.endContainer,n.endOffset);let i=!1;for(;!a.collapsed&&t.length<2;){let s=y(e.textEnd,a);if(null==s)break;if(O(a,s.startContainer,s.startOffset),r.setEnd(s.endContainer,s.endOffset),e.suffix){let a=_(e.suffix,r,n);if(a===x.NO_SUFFIX_MATCH)break;if(a===x.SUFFIX_MATCH){i=!0,t.push(r.cloneRange());continue}if(a===x.MISPLACED_SUFFIX)continue}else i=!0,t.push(r.cloneRange())}if(!i)break}else if(e.suffix){let a=_(e.suffix,r,n);if(a===x.NO_SUFFIX_MATCH)break;if(a===x.SUFFIX_MATCH){t.push(r.cloneRange()),O(n,n.startContainer,n.startOffset);continue}if(a===x.MISPLACED_SUFFIX)continue}else t.push(r.cloneRange())}return t},A=e=>{for(let t of e){let e=document.createRange();e.selectNodeContents(t);let n=e.extractContents(),r=t.parentNode;r.insertBefore(n,t),r.removeChild(t)}},x={NO_SUFFIX_MATCH:0,SUFFIX_MATCH:1,MISPLACED_SUFFIX:2},_=(e,t,n)=>{let r=document.createRange();r.setStart(t.endContainer,t.endOffset),r.setEnd(n.endContainer,n.endOffset),T(r);let a=y(e,r);return null==a?x.NO_SUFFIX_MATCH:0!==a.compareBoundaryPoints(Range.START_TO_START,r)?x.MISPLACED_SUFFIX:x.SUFFIX_MATCH},O=(e,t,n)=>{try{e.setStart(t,n+1)}catch(n){e.setStartAfter(t)}},T=e=>{let t=N(e),n=t.nextNode();for(;!e.collapsed&&null!=n;){if(n!==e.startContainer&&e.setStart(n,0),n.textContent.length>e.startOffset){let t=n.textContent[e.startOffset];if(!t.match(/\s/))return}try{e.setStart(n,e.startOffset+1)}catch(r){null==(n=t.nextNode())?e.collapse():e.setStart(n,0)}}},N=e=>{let t=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT,t=>B(t,e));return t},w=e=>{let t=e;for(;null!=t&&!(t instanceof HTMLElement);)t=t.parentNode;if(null!=t){let e=window.getComputedStyle(t);if("hidden"===e.visibility||"none"===e.display||0===e.height||0===e.width||0===e.opacity)return!1}return!0},v=(e,t)=>(null==t||t.intersectsNode(e))&&w(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT,B=(e,t)=>(null==t||t.intersectsNode(e))&&w(e)?e.nodeType===Node.TEXT_NODE?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT,R=(e,t)=>{let n=[],r=[],a=Array.from(function*(e,t){let n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:t}),r=new Set;for(;null!==W(n,r);)yield n.currentNode}(e,e=>v(e,t)));for(let e of a)e.nodeType===Node.TEXT_NODE?r.push(e):e instanceof HTMLElement&&C.includes(e.tagName)&&r.length>0&&(n.push(r),r=[]);return r.length>0&&n.push(r),n},I=(e,t,n)=>(1===e.length?e[0].textContent.substring(t,n):e[0].textContent.substring(t)+e.slice(1,-1).reduce((e,t)=>e+t.textContent,"")+e.slice(-1)[0].textContent.substring(0,n)).replace(/[\t\n\r ]+/g," "),y=(e,t)=>{let n=R(t.commonAncestorContainer,t),r=U();for(let a of n){let n=L(e,t,a,r);if(void 0!==n)return n}},L=(e,t,n,r)=>{let a,i;if(!e||!t||!(n||[]).length)return;let s=H(I(n,0,void 0)),o=H(e),u=n[0]===t.startNode?t.startOffset:0;for(;u<s.length;){let e=s.indexOf(o,u);if(-1===e)break;if(P(s,e,o.length,r)&&(a=M(e,n,!1),i=M(e+o.length,n,!0)),null!=a&&null!=i){let e=document.createRange();if(e.setStart(a.node,a.offset),e.setEnd(i.node,i.offset),0>=t.compareBoundaryPoints(Range.START_TO_START,e)&&t.compareBoundaryPoints(Range.END_TO_END,e)>=0)return e}u=e+1}},M=(e,t,n)=>{let r,a=0;for(let i=0;i<t.length;i++){let s=t[i];r||(r=H(s.data));let o=a+r.length;if(n&&(o+=1),o>e){let t=e-a,i=Math.min(e-a,s.data.length),o=n?r.substring(0,t):r.substring(t),u=n?H(s.data.substring(0,i)):H(s.data.substring(i)),l=(n?-1:1)*(o.length>u.length?-1:1);for(;i>=0&&i<=s.data.length;){if(u.length===o.length)return{node:s,offset:i};i+=l,u=n?H(s.data.substring(0,i)):H(s.data.substring(i))}}if(a+=r.length,i+1<t.length){let e=H(t[i+1].data);" "===r.slice(-1)&&" "===e.slice(0,1)&&(a-=1),r=e}}},P=(e,t,n,r)=>{if(t<0||t>=e.length||n<=0||t+n>e.length)return!1;if(r){let a=r.segment(e),i=a.containing(t);if(!i||i.isWordLike&&i.index!=t)return!1;let s=t+n,o=a.containing(s);if(o&&o.isWordLike&&o.index!=s)return!1}else if(e[t].match(F)&&(++t,!--n)||e[t+n-1].match(F)&&!--n||0!==t&&!e[t-1].match(F)||t+n!==e.length&&!e[t+n].match(F))return!1;return!0},H=e=>(e||"").normalize("NFKD").replace(/\s+/g," ").toLowerCase(),U=()=>{if(Intl.Segmenter){let e=document.documentElement.lang||navigator.languages;return new Intl.Segmenter(e,{granularity:"word"})}},W=(e,t)=>{if(!t.has(e.currentNode)){let t=e.firstChild();if(null!==t)return t}let n=e.nextSibling();if(null!==n)return n;let r=e.parentNode();return null!==r&&t.add(r),r},X={BLOCK_ELEMENTS:C,BOUNDARY_CHARS:F,NON_BOUNDARY_CHARS:/[^\t-\r -#%-*,-/:;?@[-\]_{}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,acceptNodeIfVisibleInRange:v,normalizeString:H,makeNewSegmenter:U,forwardTraverse:W,backwardTraverse:(e,t)=>{if(!t.has(e.currentNode)){let t=e.lastChild();if(null!==t)return t}let n=e.previousSibling();if(null!==n)return n;let r=e.parentNode();return null!==r&&t.add(r),r},makeTextNodeWalker:N,isNodeVisible:w},j=()=>new Promise(e=>setTimeout(e,0)),Y=async(e,t)=>{let n,r;$(t);try{n=e.getRangeAt(0)}catch{return{status:i.INVALID_SELECTION}}eu(n),ec(n);let a=n.cloneRange();if(el(n),n.collapsed)return{status:i.INVALID_SELECTION};if(Q(n)){let e=X.normalizeString(n.toString()),t={textStart:e};if(e.length>=20&&K(t))return{status:i.SUCCESS,fragment:t};r=new G().setExactTextMatch(e)}else{let e=q(n),t=z(n);r=e&&t?new G().setStartAndEndSearchSpace(e,t):new G().setSharedSearchSpace(n.toString().trim())}let s=document.createRange();s.selectNodeContents(document.body);let o=s.cloneRange();s.setEnd(a.startContainer,a.startOffset),o.setStart(a.endContainer,a.endOffset);let u=z(s),l=q(o);(u||l)&&r.setPrefixAndSuffixSearchSpace(u,l),r.useSegmenter(X.makeNewSegmenter());let d=!1;do{await j(),Z(),d=r.embiggen();let e=r.tryToMakeUniqueFragment();if(null!=e)return{status:i.SUCCESS,fragment:e}}while(d)return{status:i.AMBIGUOUS}},Z=()=>{let e=Date.now()-r;if(e>500){let t=Error(`Fragment generation timed out after ${e} ms.`);throw t.isTimeout=!0,t}},$=e=>{r=e},q=e=>{let t=ee(e),n=eo(t,e.endContainer);if(!n)return;let r=new Set;e.startContainer.nodeType===Node.ELEMENT_NODE&&e.startOffset===e.startContainer.childNodes.length&&r.add(e.startContainer);let a=t,i=new V(e,!0),s=e.cloneRange();for(;!s.collapsed&&null!=t;){if(Z(),t.contains(a)?s.setStartAfter(t):s.setStartBefore(t),i.appendNode(t),null!==i.textInBlock)return i.textInBlock;t=X.forwardTraverse(n,r)}},z=e=>{let t=et(e),n=eo(t,e.startContainer);if(!n)return;let r=new Set;e.endContainer.nodeType===Node.ELEMENT_NODE&&0===e.endOffset&&r.add(e.endContainer);let a=t,i=new V(e,!1),s=e.cloneRange();for(;!s.collapsed&&null!=t;){if(Z(),t.contains(a)?s.setEnd(t,0):s.setEndAfter(t),i.appendNode(t),null!==i.textInBlock)return i.textInBlock;t=X.backwardTraverse(n,r)}},G=class{tryToMakeUniqueFragment(){let e;if(e=this.mode===this.Mode.CONTEXT_ONLY?{textStart:this.exactTextMatch}:{textStart:this.getStartSearchSpace().substring(0,this.startOffset).trim(),textEnd:this.getEndSearchSpace().substring(this.endOffset).trim()},null!=this.prefixOffset){let t=this.getPrefixSearchSpace().substring(this.prefixOffset).trim();t&&(e.prefix=t)}if(null!=this.suffixOffset){let t=this.getSuffixSearchSpace().substring(0,this.suffixOffset).trim();t&&(e.suffix=t)}return K(e)?e:void 0}embiggen(){let e=!0;if(this.mode===this.Mode.SHARED_START_AND_END?this.startOffset>=this.endOffset&&(e=!1):this.mode===this.Mode.ALL_PARTS?this.startOffset===this.getStartSearchSpace().length&&this.backwardsEndOffset()===this.getEndSearchSpace().length&&(e=!1):this.mode===this.Mode.CONTEXT_ONLY&&(e=!1),e){let e=this.getNumberOfRangeWordsToAdd();if(this.startOffset<this.getStartSearchSpace().length){let t=0;if(null!=this.getStartSegments())for(;t<e&&this.startOffset<this.getStartSearchSpace().length;)this.startOffset=this.getNextOffsetForwards(this.getStartSegments(),this.startOffset,this.getStartSearchSpace()),t++;else{let n=this.startOffset;do{Z();let e=this.getStartSearchSpace().substring(this.startOffset+1).search(X.BOUNDARY_CHARS);-1===e?this.startOffset=this.getStartSearchSpace().length:this.startOffset=this.startOffset+1+e,-1!==this.getStartSearchSpace().substring(n,this.startOffset).search(X.NON_BOUNDARY_CHARS)&&(n=this.startOffset,t++)}while(this.startOffset<this.getStartSearchSpace().length&&t<e)}this.mode===this.Mode.SHARED_START_AND_END&&(this.startOffset=Math.min(this.startOffset,this.endOffset))}if(this.backwardsEndOffset()<this.getEndSearchSpace().length){let t=0;if(null!=this.getEndSegments())for(;t<e&&this.endOffset>0;)this.endOffset=this.getNextOffsetBackwards(this.getEndSegments(),this.endOffset),t++;else{let n=this.backwardsEndOffset();do{Z();let e=this.getBackwardsEndSearchSpace().substring(this.backwardsEndOffset()+1).search(X.BOUNDARY_CHARS);-1===e?this.setBackwardsEndOffset(this.getEndSearchSpace().length):this.setBackwardsEndOffset(this.backwardsEndOffset()+1+e),-1!==this.getBackwardsEndSearchSpace().substring(n,this.backwardsEndOffset()).search(X.NON_BOUNDARY_CHARS)&&(n=this.backwardsEndOffset(),t++)}while(this.backwardsEndOffset()<this.getEndSearchSpace().length&&t<e)}this.mode===this.Mode.SHARED_START_AND_END&&(this.endOffset=Math.max(this.startOffset,this.endOffset))}}let t=!1;if((!e||this.startOffset+this.backwardsEndOffset()<20||this.numIterations>=1)&&(null!=this.backwardsPrefixOffset()&&this.backwardsPrefixOffset()!==this.getPrefixSearchSpace().length||null!=this.suffixOffset&&this.suffixOffset!==this.getSuffixSearchSpace().length)&&(t=!0),t){let e=this.getNumberOfContextWordsToAdd();if(this.backwardsPrefixOffset()<this.getPrefixSearchSpace().length){let t=0;if(null!=this.getPrefixSegments())for(;t<e&&this.prefixOffset>0;)this.prefixOffset=this.getNextOffsetBackwards(this.getPrefixSegments(),this.prefixOffset),t++;else{let n=this.backwardsPrefixOffset();do{Z();let e=this.getBackwardsPrefixSearchSpace().substring(this.backwardsPrefixOffset()+1).search(X.BOUNDARY_CHARS);-1===e?this.setBackwardsPrefixOffset(this.getBackwardsPrefixSearchSpace().length):this.setBackwardsPrefixOffset(this.backwardsPrefixOffset()+1+e),-1!==this.getBackwardsPrefixSearchSpace().substring(n,this.backwardsPrefixOffset()).search(X.NON_BOUNDARY_CHARS)&&(n=this.backwardsPrefixOffset(),t++)}while(this.backwardsPrefixOffset()<this.getPrefixSearchSpace().length&&t<e)}}if(this.suffixOffset<this.getSuffixSearchSpace().length){let t=0;if(null!=this.getSuffixSegments())for(;t<e&&this.suffixOffset<this.getSuffixSearchSpace().length;)this.suffixOffset=this.getNextOffsetForwards(this.getSuffixSegments(),this.suffixOffset,this.suffixOffset),t++;else{let n=this.suffixOffset;do{Z();let e=this.getSuffixSearchSpace().substring(this.suffixOffset+1).search(X.BOUNDARY_CHARS);-1===e?this.suffixOffset=this.getSuffixSearchSpace().length:this.suffixOffset=this.suffixOffset+1+e,-1!==this.getSuffixSearchSpace().substring(n,this.suffixOffset).search(X.NON_BOUNDARY_CHARS)&&(n=this.suffixOffset,t++)}while(this.suffixOffset<this.getSuffixSearchSpace().length&&t<e)}}}return this.numIterations++,e||t}setStartAndEndSearchSpace(e,t){return this.startSearchSpace=e,this.endSearchSpace=t,this.backwardsEndSearchSpace=J(t),this.startOffset=0,this.endOffset=t.length,this.mode=this.Mode.ALL_PARTS,this}setSharedSearchSpace(e){return this.sharedSearchSpace=e,this.backwardsSharedSearchSpace=J(e),this.startOffset=0,this.endOffset=e.length,this.mode=this.Mode.SHARED_START_AND_END,this}setExactTextMatch(e){return this.exactTextMatch=e,this.mode=this.Mode.CONTEXT_ONLY,this}setPrefixAndSuffixSearchSpace(e,t){return e&&(this.prefixSearchSpace=e,this.backwardsPrefixSearchSpace=J(e),this.prefixOffset=e.length),t&&(this.suffixSearchSpace=t,this.suffixOffset=0),this}useSegmenter(e){return null==e||(this.mode===this.Mode.ALL_PARTS?(this.startSegments=e.segment(this.startSearchSpace),this.endSegments=e.segment(this.endSearchSpace)):this.mode===this.Mode.SHARED_START_AND_END&&(this.sharedSegments=e.segment(this.sharedSearchSpace)),this.prefixSearchSpace&&(this.prefixSegments=e.segment(this.prefixSearchSpace)),this.suffixSearchSpace&&(this.suffixSegments=e.segment(this.suffixSearchSpace))),this}getNumberOfContextWordsToAdd(){return 0===this.backwardsPrefixOffset()&&0===this.suffixOffset?3:1}getNumberOfRangeWordsToAdd(){return 0===this.startOffset&&0===this.backwardsEndOffset()?3:1}getNextOffsetForwards(e,t,n){let r=e.containing(t);for(;null!=r;){Z();let t=r.index+r.segment.length;if(r.isWordLike)return t;r=e.containing(t)}return n.length}getNextOffsetBackwards(e,t){let n=e.containing(t);for(n&&t!=n.index||(n=e.containing(t-1));null!=n;){if(Z(),n.isWordLike)return n.index;n=e.containing(n.index-1)}return 0}getStartSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSearchSpace:this.startSearchSpace}getStartSegments(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSegments:this.startSegments}getEndSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSearchSpace:this.endSearchSpace}getEndSegments(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSegments:this.endSegments}getBackwardsEndSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.backwardsSharedSearchSpace:this.backwardsEndSearchSpace}getPrefixSearchSpace(){return this.prefixSearchSpace}getPrefixSegments(){return this.prefixSegments}getBackwardsPrefixSearchSpace(){return this.backwardsPrefixSearchSpace}getSuffixSearchSpace(){return this.suffixSearchSpace}getSuffixSegments(){return this.suffixSegments}backwardsEndOffset(){return this.getEndSearchSpace().length-this.endOffset}setBackwardsEndOffset(e){this.endOffset=this.getEndSearchSpace().length-e}backwardsPrefixOffset(){return null==this.prefixOffset?null:this.getPrefixSearchSpace().length-this.prefixOffset}setBackwardsPrefixOffset(e){null!=this.prefixOffset&&(this.prefixOffset=this.getPrefixSearchSpace().length-e)}constructor(){this.Mode={ALL_PARTS:1,SHARED_START_AND_END:2,CONTEXT_ONLY:3},this.startOffset=null,this.endOffset=null,this.prefixOffset=null,this.suffixOffset=null,this.prefixSearchSpace="",this.backwardsPrefixSearchSpace="",this.suffixSearchSpace="",this.numIterations=0}},V=class{appendNode(e){if(null!==this.textInBlock)return;if(eh(e)){this.textFound?(this.isForwardTraversal||this.textNodes.reverse(),this.textInBlock=this.textNodes.map(e=>e.textContent).join("").trim()):this.textNodes=[];return}if(!eg(e))return;let t=this.getNodeIntersectionWithRange(e);this.textFound=this.textFound||""!==t.textContent.trim(),this.textNodes.push(t)}getNodeIntersectionWithRange(e){let t=null,n=null;return(e===this.searchRange.startContainer&&0!==this.searchRange.startOffset&&(t=this.searchRange.startOffset),e===this.searchRange.endContainer&&this.searchRange.endOffset!==e.textContent.length&&(n=this.searchRange.endOffset),null!==t||null!==n)?{textContent:e.textContent.substring(t??0,n??e.textContent.length)}:e}constructor(e,t){this.searchRange=e,this.isForwardTraversal=t,this.textFound=!1,this.textNodes=[],this.textInBlock=null}},K=e=>1===b(e).length,J=e=>[...e||""].reverse().join(""),Q=e=>!(e.toString().length>em)&&!ea(e),ee=e=>{let t=e.startContainer;return t.nodeType==Node.ELEMENT_NODE&&e.startOffset<t.childNodes.length&&(t=t.childNodes[e.startOffset]),t},et=e=>{let t=e.endContainer;return t.nodeType==Node.ELEMENT_NODE&&e.endOffset>0&&(t=t.childNodes[e.endOffset-1]),t},en=e=>{let t=ee(e);if(eg(t)&&X.isNodeVisible(t))return t;let n=X.makeTextNodeWalker(e);return n.currentNode=t,n.nextNode()},er=e=>{let t=et(e);if(eg(t)&&X.isNodeVisible(t))return t;let n=X.makeTextNodeWalker(e);return n.currentNode=t,X.backwardTraverse(n,new Set)},ea=e=>{let t=e.cloneRange(),n=ee(t),r=eo(n);if(!r)return!1;let a=new Set;for(;!t.collapsed&&null!=n;){if(eh(n))return!0;null!=n&&t.setStartAfter(n),n=X.forwardTraverse(r,a),Z()}return!1},ei=(e,t)=>{if(e.nodeType!==Node.TEXT_NODE)return -1;let n=null!=t?t:e.data.length;if(n<e.data.length&&X.BOUNDARY_CHARS.test(e.data[n]))return n;let r=e.data.substring(0,n),a=J(r).search(X.BOUNDARY_CHARS);return -1!==a?n-a:-1},es=(e,t)=>{if(e.nodeType!==Node.TEXT_NODE)return -1;let n=null!=t?t:0;if(n<e.data.length&&n>0&&X.BOUNDARY_CHARS.test(e.data[n-1]))return n;let r=e.data.substring(n),a=r.search(X.BOUNDARY_CHARS);return -1!==a?n+a:-1},eo=(e,t)=>{if(!e)return;let n=e,r=null!=t?t:e;for(;!n.contains(r)||!eh(n);)n.parentNode&&(n=n.parentNode);let a=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,e=>X.acceptNodeIfVisibleInRange(e));return a.currentNode=e,a},eu=e=>{let t=X.makeNewSegmenter();if(t){let n=ee(e);n!==e.startContainer&&e.setStartBefore(n),ed(t,!1,e)}else{let t=ei(e.startContainer,e.startOffset);if(-1!==t){e.setStart(e.startContainer,t);return}if(eh(e.startContainer)&&0===e.startOffset)return;let n=eo(e.startContainer);if(!n)return;let r=new Set,a=X.backwardTraverse(n,r);for(;null!=a;){let t=ei(a);if(-1!==t){e.setStart(a,t);return}if(eh(a)){a.contains(e.startContainer)?e.setStart(a,0):e.setStartAfter(a);return}a=X.backwardTraverse(n,r),e.collapse()}}},el=e=>{let t=en(e);if(null==t){e.collapse();return}let n=ee(e);n!==t&&e.setStart(t,0);let r=et(e),a=er(e);r!==a&&e.setEnd(a,a.textContent.length)},ed=(e,t,n)=>{let r=t?{node:n.endContainer,offset:n.endOffset}:{node:n.startContainer,offset:n.startOffset},a=ef(r.node),i=a.preNodes.reduce((e,t)=>e.concat(t.textContent),""),s=a.innerNodes.reduce((e,t)=>e.concat(t.textContent),""),o=i.length;r.node.nodeType===Node.TEXT_NODE?o+=r.offset:t&&(o+=s.length);let u=a.postNodes.reduce((e,t)=>e.concat(t.textContent),""),l=[...a.preNodes,...a.innerNodes,...a.postNodes];if(0==l.length)return;let d=i.concat(s,u),f=e.segment(d),c=f.containing(o);if(!c){t?n.setEndAfter(l[l.length-1]):n.setEndBefore(l[0]);return}if(!c.isWordLike||o===c.index||o===c.index+c.segment.length)return;let h=t?c.index+c.segment.length:c.index,g=0;for(let e of l){if(g<=h&&h<g+e.textContent.length){let r=h-g;t?r>=e.textContent.length?n.setEndAfter(e):n.setEnd(e,r):r>=e.textContent.length?n.setStartAfter(e):n.setStart(e,r);return}g+=e.textContent.length}t?n.setEndAfter(l[l.length-1]):n.setStartBefore(l[0])},ef=e=>{let t=[],n=eo(e);if(!n)return;let r=new Set,a=X.backwardTraverse(n,r);for(;null!=a&&!eh(a);)Z(),a.nodeType===Node.TEXT_NODE&&t.push(a),a=X.backwardTraverse(n,r);t.reverse();let i=[];if(e.nodeType===Node.TEXT_NODE)i.push(e);else{let t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,e=>X.acceptNodeIfVisibleInRange(e));t.currentNode=e;let n=t.nextNode();for(;null!=n;)Z(),n.nodeType===Node.TEXT_NODE&&i.push(n),n=t.nextNode()}let s=[],o=eo(e);if(!o)return;let u=new Set([e]),l=X.forwardTraverse(o,u);for(;null!=l&&!eh(l);)Z(),l.nodeType===Node.TEXT_NODE&&s.push(l),l=X.forwardTraverse(o,u);return{preNodes:t,innerNodes:i,postNodes:s}},ec=e=>{let t=X.makeNewSegmenter();if(t){let n=et(e);n!==e.endContainer&&e.setEndAfter(n),ed(t,!0,e)}else{let t=e.endOffset,n=e.endContainer;n.nodeType===Node.ELEMENT_NODE&&e.endOffset<n.childNodes.length&&(n=n.childNodes[e.endOffset]);let r=eo(n);if(!r)return;let a=new Set([n]);for(;null!=n;){Z();let i=es(n,t);if(t=null,-1!==i){e.setEnd(n,i);return}if(eh(n)){n.contains(e.endContainer)?e.setEnd(n,n.childNodes.length):e.setEndBefore(n);return}n=X.forwardTraverse(r,a)}e.collapse()}},eh=e=>e.nodeType===Node.ELEMENT_NODE&&(X.BLOCK_ELEMENTS.includes(e.tagName)||"HTML"===e.tagName||"BODY"===e.tagName),eg=e=>e.nodeType===Node.TEXT_NODE,em=300;!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.INVALID_SELECTION=1]="INVALID_SELECTION",e[e.AMBIGUOUS=2]="AMBIGUOUS",e[e.TIMEOUT=3]="TIMEOUT",e[e.EXECUTION_FAILED=4]="EXECUTION_FAILED"}(i||(i={}));let ep="text-bookmark",eS=e=>{let t=/^(?:(.+?)-,)?(?:(.+?))(?:,([^-]+?))?(?:,-(.+?))?$/;return{prefix:decodeURIComponent(e.replace(t,"$1")),textStart:decodeURIComponent(e.replace(t,"$2")),textEnd:decodeURIComponent(e.replace(t,"$3")),suffix:decodeURIComponent(e.replace(t,"$4"))}},ek=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();try{return await Y(e,t)}catch(e){if(e.isTimeout)return{status:i.TIMEOUT};return{status:i.EXECUTION_FAILED}}},eD=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,t=null;for(;t=e.getElementsByClassName(ep)[0];)A([t])},eE=e=>{if(e.startContainer.nodeType!=Node.TEXT_NODE||e.endContainer.nodeType!=Node.TEXT_NODE)return[];if(e.startContainer===e.endContainer){let t=document.createElement("mark");return t.setAttribute("class",ep),e.surroundContents(t),[t]}let t=e.startContainer,n=e.cloneRange();n.setEndAfter(t);let r=e.endContainer,a=e.cloneRange();a.setStartBefore(r);let i=[];e.setStartAfter(t),e.setEndBefore(r);let s=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:t=>e.intersectsNode(t)?C.includes(t.tagName)||t.nodeType===Node.TEXT_NODE?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP:NodeFilter.FILTER_REJECT}),o=s.nextNode();for(;o;){if(o.nodeType===Node.TEXT_NODE){let e=document.createElement("mark");e.setAttribute("class",ep),o.parentNode.insertBefore(e,o),e.appendChild(o),i.push(e)}o=s.nextNode()}let u=document.createElement("mark");u.setAttribute("class",ep),n.surroundContents(u);let l=document.createElement("mark");return l.setAttribute("class",ep),a.surroundContents(l),[u,...i,l]};function eC(e,t){return Object.entries(e).reduce((e,n)=>{let[r,a]=n;return{...e,[r]:t(a)}},{})}let eF=async e=>{e=eb(e);let t=await ek({getRangeAt:t=>e});return t.fragment&&(t.fragment=eC(t.fragment,e=>e.trim())),t},eb=e=>{let t=e.toString(),n=t.search(/\S/);if(0===n||-1===n)return e;let r=document.createRange();return r.setStart(e.startContainer,e.startOffset+n),r.setEnd(e.endContainer,e.endOffset),r},eA=e=>{let{textStart:t,textEnd:n,prefix:r,suffix:a}=eC(e,encodeURIComponent);return`${r?r+"-,":""}${t}${n?","+n:""}${a?",-"+a:""}`},ex=e=>eS(e),e_=e=>`/readfic/${e.fanfic.slug}/${e.fanfic.partId||"all-parts"}#bookmark`,eO=(e,t)=>location.pathname.endsWith("/all-parts")&&!e.fanfic.partId||e.fanfic.partId&&t===e.fanfic.partId,eT=(e,t)=>{if(eO(e,t)){let e=document.getElementsByClassName(ep)[0];return!!e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),!0)}return location.assign(e_(e)),!0};var eN=n(7482);!function(e){e.List="/bookmarks/list",e.Save="/bookmarks/create",e.Delete="/bookmarks/delete"}(s||(s={}));let ew=async e=>{let t=await eN.p.send(s.List,{p:e}).then(e=>e.data);return t.items=t.items.map(e=>({...e,createdAt:new Date(e.createdAt)})),t},ev=e=>eN.p.send(s.Save,e).then(e=>e.data),eB=async e=>{await eN.p.send(s.Delete,{id:e})};var eR=n(2142);function eI(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function ey(e,t,n){if(!t.has(e))throw TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function eL(e,t){var n=ey(e,t,"get");return n.get?n.get.call(e):n.value}function eM(e,t,n){eI(e,t),t.set(e,n)}function eP(e,t,n){var r=ey(e,t,"set");return!function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=n}}(e,r,n),n}function eH(e,t,n){if(!t.has(e))throw TypeError("attempted to get private field on non-instance");return n}function eU(e,t){eI(e,t),t.add(e)}var eW=new WeakMap,eX=new WeakMap,ej=new WeakMap,eY=new WeakMap,eZ=new WeakSet,e$=new WeakSet,eq=new WeakSet;class ez{disconnect(){eL(this,eW).disconnect(),eL(this,ej)?.abort()}constructor(e,t){eU(this,eZ),eU(this,e$),eU(this,eq),eM(this,eW,{writable:!0,value:void 0}),eM(this,eX,{writable:!0,value:void 0}),eM(this,ej,{writable:!0,value:void 0}),eM(this,eY,{writable:!0,value:void 0}),eP(this,eX,e),eP(this,eW,new MutationObserver(()=>{eH(this,eZ,eG).call(this)})),eL(this,eW).observe(e,{childList:!0,subtree:!0}),eP(this,eY,{onClick:e=>{e.stopPropagation(),t({isFocused:!0})},onClickOutside:()=>t({isFocused:!1})})}}function eG(){eL(this,ej)?.abort();let e=eH(this,e$,eV).call(this);e.length&&(eP(this,ej,new AbortController),e.forEach(e=>eH(this,eq,eK).call(this,e,eL(this,ej).signal)))}function eV(){return[...eL(this,eX).querySelectorAll(".text-bookmark")]}function eK(e,t){e.addEventListener("click",eL(this,eY).onClick,{signal:t}),(0,eR.fc)({el:e},eL(this,eY).onClickOutside,{signal:t})}let eJ=["href"],eQ={class:"fanfic"},e0={class:"fanfic__title"},e1={key:0,class:"fanfic__part-title"},e2=["href"],e3={class:"bookmark-text"},e6={key:0},e5={class:"highlight"},e8={key:1},e7={class:"time"};var e4=n(2315);let e9=(0,o.aZ)({props:{bookmark:{type:Object,required:!0}},computed:{fragment(){return ex(this.bookmark.fragment)},humanDate(){return(0,e4.uv)(this.bookmark.createdAt.getTime()/1e3)},href(){return e_(this.bookmark)}}});var te=n(1334);let tt=(0,te.Z)(e9,[["render",function(e,t,n,r,a,i){let s=(0,o.up)("svg-icon");return(0,o.wg)(),(0,o.iD)("a",{class:"internal-list__item item",href:e.href},[(0,o._)("div",eQ,[(0,o._)("div",e0,(0,u.zw)(e.bookmark.fanfic.title),1),e.bookmark.fanfic.partTitle?((0,o.wg)(),(0,o.iD)("div",e1,(0,u.zw)(e.bookmark.fanfic.partTitle),1)):(0,o.kq)("v-if",!0),(0,o._)("a",{class:"fanfic__author",href:"/authors/"+e.bookmark.fanfic.authorSlug},[(0,o.Wm)(s,{"icon-name":"ic_user",class:"icon-description"}),(0,o.Uk)(" "+(0,u.zw)(e.bookmark.fanfic.authorName),1)],8,e2)]),(0,o._)("div",e3,[e.fragment.prefix?((0,o.wg)(),(0,o.iD)("span",e6,(0,u.zw)(e.fragment.prefix),1)):(0,o.kq)("v-if",!0),(0,o._)("span",e5,(0,u.zw)(e.fragment.textStart),1),e.fragment.textEnd||e.fragment.suffix?((0,o.wg)(),(0,o.iD)("span",e8,(0,u.zw)(e.fragment.textEnd+e.fragment.suffix),1)):(0,o.kq)("v-if",!0)]),(0,o._)("div",e7,(0,u.zw)(e.humanDate),1),(0,o._)("div",{class:"buttons remove-button",onClick:t[0]||(t[0]=(0,l.iM)(t=>e.$emit("remove-click"),["prevent"]))},[(0,o.Wm)(s,{"icon-name":"ic_cancel-circle"})])],8,eJ)}],["__scopeId","data-v-2b4ff377"]]),tn={class:"item"},tr=(0,o.uE)('<div class="fanfic" data-v-01ba6eb5><div class="skeleton-box" style="width:70%;" data-v-01ba6eb5></div><div class="skeleton-box hidden-xs" style="width:60px;" data-v-01ba6eb5></div><div class="skeleton-box" style="width:50%;" data-v-01ba6eb5></div></div><div class="bookmark-text" data-v-01ba6eb5><div class="skeleton-box" style="width:75%;" data-v-01ba6eb5></div></div><div class="time" data-v-01ba6eb5><div class="skeleton-box" style="width:100px;" data-v-01ba6eb5></div></div><div class="remove-button" data-v-01ba6eb5><div class="skeleton-box" style="width:16px;" data-v-01ba6eb5></div></div>',4),ta=[tr],ti=(0,o.aZ)({}),ts=(0,te.Z)(ti,[["render",function(e,t,n,r,a,i){return(0,o.wg)(),(0,o.iD)("div",tn,ta)}],["__scopeId","data-v-01ba6eb5"]]);var to=n(8032);let tu={class:"paging"},tl=["disabled"],td=["disabled"],tf=(0,o.aZ)({__name:"bookmark-list-paging",props:{page:{},nextPageExists:{type:Boolean}},setup:e=>(e,t)=>((0,o.wg)(),(0,o.iD)("div",tu,[(0,o._)("button",{disabled:1===e.page,onClick:t[0]||(t[0]=t=>e.$emit("back"))},[(0,o.Wm)(to.Z,{"icon-name":"ic_arrow-left"})],8,tl),(0,o._)("button",{disabled:!e.nextPageExists,onClick:t[1]||(t[1]=t=>e.$emit("forward"))},[(0,o.Wm)(to.Z,{"icon-name":"ic_arrow-right"})],8,td)]))}),tc=(0,te.Z)(tf,[["__scopeId","data-v-d82e0746"]]);var th=n(2967);let tg=(0,o.aZ)({components:{BookmarkListItem:tt,BookmarkListItemSkeleton:ts,BookmarkListPaging:tc},data(){let e=new URLSearchParams(window.location.search);return{i18n:th,page:+(e.get("p")||1),listModel:null}},computed:{isLoading(){return!this.listModel},noBookmarks(){return!this.isLoading&&1===this.page&&!this.listModel.items.length}},watch:{page:{immediate:!0,async handler(){history?.pushState(null,"","/home/bookmarks"+(1===this.page?"":"?p="+this.page)),await this.refresh()}}},methods:{async remove(e){confirm(th.t("bookmark-list.delete-bookmarks-confirm"))&&(await eB(e.id),await this.loadList())},async refresh(){this.listModel=null,this.loadList()},async loadList(){this.listModel=await ew(this.page)},incrementPage(){this.page++},decrementPage(){this.page--}}}),tm=(0,te.Z)(tg,[["render",function(e,t,n,r,a,i){let s=(0,o.up)("svg-icon"),C=(0,o.up)("BookmarkListPaging"),F=(0,o.up)("BookmarkListItemSkeleton"),b=(0,o.up)("BookmarkListItem");return(0,o.wg)(),(0,o.iD)("div",null,[e.noBookmarks?((0,o.wg)(),(0,o.iD)("div",d,[(0,o._)("div",f,[(0,o._)("p",null,[(0,o.Uk)((0,u.zw)(e.i18n.t("bookmark-list.how-to-add-bookmark"))+" ",1),(0,o._)("span",c,[(0,o.Wm)(s,{"icon-name":"ic_bookmark_plus"}),(0,o._)("span",h,(0,u.zw)(e.i18n.t("bookmark-list.add-bookmark")),1)])]),(0,o._)("p",null,[(0,o.Uk)((0,u.zw)(e.i18n.t("bookmark-list.how-to-view-bookmark"))+" ",1),(0,o._)("span",g,[(0,o.Wm)(s,{"icon-name":"ic_bookmark_check"})]),m,(0,o.Uk)(" "+(0,u.zw)(e.i18n.t("bookmark-list.result-view-bookmark")),1)]),(0,o._)("p",null,[(0,o.Uk)((0,u.zw)(e.i18n.t("bookmark-list.how-to-remove-bookmark"))+" ",1),(0,o._)("span",p,[(0,o.Wm)(s,{"icon-name":"ic_bookmark_remove"}),(0,o._)("span",S,(0,u.zw)(e.i18n.t("bookmark-list.remove-bookmark")),1)])]),(0,o._)("p",null,(0,u.zw)(e.i18n.t("bookmark-list.where-bookmark")),1)]),(0,o._)("p",k,(0,u.zw)(e.i18n.t("bookmark-list.no-bookmarks")),1)])):((0,o.wg)(),(0,o.iD)(o.HY,{key:1},[(0,o.Wm)(C,{class:"paging",page:e.isLoading?1:e.page,"next-page-exists":!e.isLoading&&e.listModel.nextPageExists,onBack:e.decrementPage,onForward:e.incrementPage},null,8,["page","next-page-exists","onBack","onForward"]),(0,o.wy)((0,o._)("div",D,[((0,o.wg)(),(0,o.iD)(o.HY,null,(0,o.Ko)(3,e=>(0,o.Wm)(F,{class:"item",key:e})),64))],512),[[l.F8,e.isLoading]]),e.isLoading?(0,o.kq)("v-if",!0):((0,o.wg)(),(0,o.iD)("div",E,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(e.listModel.items,t=>((0,o.wg)(),(0,o.j4)(b,{key:t.fanfic.id.toString()+t.fanfic.partId,class:"item",bookmark:t,onRemoveClick:n=>e.remove(t)},null,8,["bookmark","onRemoveClick"]))),128))]))],64))])}],["__scopeId","data-v-3f5a27ac"]]),tp=tm,tS={class:"floating-menu-button-container"},tk=["disabled"],tD={class:"btn-text"},tE=(0,o.aZ)({props:{isLoading:{type:Boolean,default:!1},variant:{type:String,default:"default"},disabled:{type:Boolean,default:!1},iconName:{type:String,required:!0}}}),tC=(0,te.Z)(tE,[["render",function(e,t,n,r,a,i){let s=(0,o.up)("svg-icon");return(0,o.wg)(),(0,o.iD)("div",tS,[(0,o._)("button",{class:(0,u.C_)(["floating-menu-button",{"floating-menu-button--red":"red"===e.variant}]),disabled:e.disabled||e.isLoading},[e.isLoading?((0,o.wg)(),(0,o.j4)(s,{key:1,"icon-name":"ic_spinner",class:"spinner"})):((0,o.wg)(),(0,o.j4)(s,{key:0,"icon-name":e.iconName},null,8,["icon-name"])),(0,o._)("span",tD,[(0,o.WI)(e.$slots,"default",{},void 0,!0)])],10,tk)])}],["__scopeId","data-v-65697bba"]]),tF=(0,o.aZ)({components:{FloatingMenuButton:tC},props:{fanficId:{type:Number,required:!0},partId:{type:Number,required:!1},selection:{type:Selection,required:!0}},emits:["created"],watch:{selection(){this.isGenerationFailed=!1}},data:()=>({isLoading:!1,isGenerationFailed:!1}),computed:{isDisabled(){return this.isLoading||this.isGenerationFailed},createButtonText(){return!this.isLoading&&this.isGenerationFailed?th.t("create-bookmark-button."):th.t("create-bookmark-button.create")}},methods:{async create(){if(!this.isDisabled){this.isLoading=!0;try{let e=await this.generateFragment(this.selection);if(this.isGenerationFailed=e?.status!==i.SUCCESS||!e.fragment,this.isGenerationFailed)return;let t=eA(e.fragment),n=await ev({fanficId:this.fanficId,partId:this.partId,fragment:t});this.$emit("created",{id:n.id,fragment:t,fanfic:{id:this.fanficId,partId:this.partId}})}finally{this.isLoading=!1}}},async generateFragment(e){if(!e)return null;if(e.anchorNode.parentNode.closest(".footnote"))return{status:i.INVALID_SELECTION};let t=e.getRangeAt(0).cloneRange();return t.toString().length>em?{status:i.INVALID_SELECTION}:await eF(t)}}}),tb=(0,te.Z)(tF,[["render",function(e,t,n,r,a,i){let s=(0,o.up)("FloatingMenuButton");return(0,o.wg)(),(0,o.j4)(s,{onTouchstart:t[0]||(t[0]=(0,l.iM)(t=>e.create(),["prevent"])),onMousedown:t[1]||(t[1]=(0,l.iM)(t=>e.create(),["prevent"])),disabled:e.isDisabled,isLoading:e.isLoading,"icon-name":"ic_bookmark_plus"},{default:(0,o.w5)(()=>[(0,o.Uk)((0,u.zw)(e.createButtonText),1)]),_:1},8,["disabled","isLoading"])}]]),tA=(0,o.aZ)({components:{FloatingMenuButton:tC},props:{bookmark:{type:[Object,null],required:!0}},emits:["removed"],data:()=>({i18n:th,isLoading:!1}),methods:{async remove(){this.isLoading=!0;try{await eB(this.bookmark.id)}finally{this.isLoading=!1}this.$emit("removed")}}}),tx=(0,te.Z)(tA,[["render",function(e,t,n,r,a,i){let s=(0,o.up)("FloatingMenuButton");return(0,o.wg)(),(0,o.j4)(s,{onClick:t[0]||(t[0]=t=>e.remove()),isLoading:e.isLoading,"icon-name":"ic_bookmark_remove",variant:"red"},{default:(0,o.w5)(()=>[(0,o.Uk)((0,u.zw)(e.i18n.t("remove-bookmark-button.remove")),1)]),_:1},8,["isLoading"])}]]);var t_=n(9824),tO=n(6820);let tT=(0,o.aZ)({components:{CreateBookmarkButton:tb,RemoveBookmarkButton:tx},props:{fanficId:{type:Number,required:!0},partId:{type:Number,required:!1},savedBookmark:{type:Object,required:!1}},data(){let e=new tO.Z([...document.querySelectorAll(".js-bookmark-area")]);return{isBookmarkFocused:!1,bookmark:this.savedBookmark||null,selectionManager:e,textBookmarkEventsObserver:new ez(document.querySelector(".js-part-text"),e=>{let{isFocused:t}=e;return this.toggleTextBookmarkFocus(t)})}},watch:{bookmark:{immediate:!0,handler(){t_.u.emit("update:bookmark",this.bookmark),this.selectionManager.clearSelection()}}},methods:{toggleTextBookmarkFocus(e){this.isBookmarkFocused=e},onBookmarkRemove(){this.bookmark=null}},unmounted(){this.selectionManager.destroy(),this.textBookmarkEventsObserver.disconnect()}}),tN=(0,te.Z)(tT,[["render",function(e,t,n,r,a,i){let s=(0,o.up)("CreateBookmarkButton"),u=(0,o.up)("RemoveBookmarkButton");return e.selectionManager.value?((0,o.wg)(),(0,o.j4)(s,{key:0,fanficId:e.fanficId,partId:e.partId,selection:e.selectionManager.value,onCreated:t[0]||(t[0]=t=>e.bookmark=t)},null,8,["fanficId","partId","selection"])):(0,o.wy)(((0,o.wg)(),(0,o.j4)(u,{key:1,bookmark:e.bookmark,onRemoved:e.onBookmarkRemove},null,8,["bookmark","onRemoved"])),[[l.F8,e.isBookmarkFocused]])}],["__scopeId","data-v-5434c65a"]]),tw=tN;var tv=n(1764),tB=n.n(tv),tR=n(9621);let tI=(0,o.aZ)({components:{BookmarkButtonCircle:tR.Z},props:{partId:{type:Number,required:!1},savedBookmark:{type:Object,default:null}},data(){let e=document.querySelector(".js-part-text");return{jsPartText:e,bookmark:this.savedBookmark}},watch:{bookmark:{immediate:!0,handler(){this.jsPartText&&this.repaintBookmark()}}},created(){t_.u.on("update:bookmark",e=>this.bookmark=e),"#bookmark"===location.hash&&this.bookmark&&(this.clearHash(),this.goToBookmark())},unmounted(){t_.u.off("update:bookmark")},methods:{clearHash(){window.history?.replaceState(null,""," ")},repaintBookmark(){if(eD(this.jsPartText),this.bookmark&&eO(this.bookmark,this.partId)){let e=ex(this.bookmark.fragment),t=b(e)[0];t&&eE(t)}},goToBookmark(){let e=eT(this.bookmark,this.partId);e||tB().error(th.t("go-to-bookmark-button.cannot-found"))}}}),ty=(0,te.Z)(tI,[["render",function(e,t,n,r,a,i){let s=(0,o.up)("BookmarkButtonCircle");return e.bookmark?((0,o.wg)(),(0,o.j4)(s,{key:0,class:"go-to-bookmark-button","icon-name":"ic_bookmark_check",onClick:e.goToBookmark},null,8,["onClick"])):(0,o.kq)("v-if",!0)}],["__scopeId","data-v-e51ac2b4"]]),tL=ty},7554:(e,t,n)=>{n.d(t,{N:()=>a,k:()=>i});var r=n(399);let a=e=>{e.querySelectorAll(".ads-in-text").forEach(e=>e.remove())},i=e=>new r.Y(e).unwrapBookmark().replaceAlignmentParagraphsWithAlignmentTags().replaceTabulationToTabInContext().trimTags().toString()},9621:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(1101),a=n(8032);let i={class:"bookmark-btn-circle"},s=(0,r.aZ)({__name:"bookmark-button-circle",props:{iconName:{}},setup:e=>(e,t)=>((0,r.wg)(),(0,r.iD)("button",i,[(0,r.Wm)(a.Z,{"icon-name":e.iconName},null,8,["icon-name"])]))});var o=n(1334);let u=(0,o.Z)(s,[["__scopeId","data-v-f17cd122"]]),l=u}}]);